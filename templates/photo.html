{% extends "base.html" %} {% block title %}{{ photo.caption or 'Our Memory' }} -
Our Memories{% endblock %} {% block content %}
<div class="container mx-auto px-4 py-8 max-w-6xl">
  <!-- Back Button -->
  <div class="mb-6">
    <a
      href="{{ url_for('index') }}"
      class="inline-flex items-center text-pink-600 hover:text-pink-500 dark:text-pink-400 dark:hover:text-pink-300 transition-colors duration-300 font-medium"
    >
      <i class="fas fa-arrow-left mr-2"></i>
      Back to Gallery
    </a>
  </div>

  <!-- Photo Detail Card -->
  <div
    class="bg-white/80 dark:bg-gray-800/80 backdrop-blur-lg rounded-2xl shadow-xl overflow-hidden border border-pink-100 dark:border-gray-700"
  >
    <div class="md:flex">
      <!-- Photo Section -->
      <div class="md:w-2/3 p-6">
        <div class="relative rounded-2xl overflow-hidden shadow-2xl">
          <img
            src="{{ url_for('uploaded_file', filename=photo.filename) }}"
            alt="{{ photo.caption or 'Our beautiful memory' }}"
            class="w-full h-auto max-h-96 object-cover transition-transform duration-500 hover:scale-105"
            id="mainPhoto"
          />

          <!-- Favorite Button -->
          <button
            class="absolute top-4 right-4 bg-white/90 dark:bg-gray-800/90 backdrop-blur-sm p-3 rounded-full shadow-lg transform transition-all duration-300 hover:scale-110"
            onclick="toggleFavorite({{ photo.id }})"
            id="favoriteBtn"
          >
            <i
              class="fas fa-heart text-2xl {% if photo.is_favorite %}text-red-500{% else %}text-gray-400{% endif %} transition-colors duration-300"
            ></i>
          </button>
        </div>

        <!-- Action Buttons -->
        {% if current_user.is_authenticated %}
        <div class="flex justify-center space-x-4 mt-6">
          <a
            href="{{ url_for('edit_photo', photo_id=photo.id) }}"
            class="inline-flex items-center px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition-all duration-300 transform hover:scale-105"
          >
            <i class="fas fa-edit mr-2"></i>
            Edit
          </a>
          <form
            action="{{ url_for('delete_photo', photo_id=photo.id) }}"
            method="POST"
            onsubmit="return confirm('Are you sure you want to delete this beautiful memory?');"
            class="inline"
          >
            <button
              type="submit"
              class="inline-flex items-center px-4 py-2 bg-red-500 text-white rounded-lg hover:bg-red-600 transition-all duration-300 transform hover:scale-105"
            >
              <i class="fas fa-trash mr-2"></i>
              Delete
            </button>
          </form>
        </div>
        {% endif %}
      </div>

      <!-- Details Section -->
      <div
        class="md:w-1/3 p-6 bg-gradient-to-b from-pink-50 to-purple-50 dark:from-gray-800 dark:to-purple-900/20 border-l border-pink-100 dark:border-gray-700"
      >
        <!-- Memory Header -->
        <div class="text-center mb-6">
          <div
            class="w-16 h-16 bg-gradient-to-r from-pink-500 to-purple-600 rounded-full flex items-center justify-center mx-auto mb-4"
          >
            <i class="fas fa-heart text-white text-2xl"></i>
          </div>
          <h2 class="text-2xl font-bold text-gray-800 dark:text-white mb-2">
            Our Memory
          </h2>
          <p class="text-sm text-gray-500 dark:text-gray-400">
            Shared on {{ photo.date_uploaded.strftime('%B %d, %Y') }}
          </p>
        </div>

        <!-- Caption -->
        <div class="mb-6">
          <h3
            class="text-lg font-semibold text-gray-700 dark:text-gray-300 mb-3 flex items-center"
          >
            <i class="fas fa-quote-left text-pink-500 mr-2"></i>
            The Story
          </h3>
          <div
            class="bg-white/50 dark:bg-gray-700/50 rounded-xl p-4 border border-pink-100 dark:border-gray-600"
          >
            <p class="text-gray-700 dark:text-gray-300 leading-relaxed">
              {{ photo.caption or "This beautiful moment speaks for itself.
              Every second with you is a memory to cherish forever. ðŸ’–" }}
            </p>
          </div>
        </div>

        <!-- Tags -->
        {% if photo.tags %}
        <div class="mb-6">
          <h3
            class="text-lg font-semibold text-gray-700 dark:text-gray-300 mb-3 flex items-center"
          >
            <i class="fas fa-tags text-pink-500 mr-2"></i>
            Tags
          </h3>
          <div class="flex flex-wrap gap-2">
            {% for tag in photo.tags.split(',') %}
            <span
              class="inline-flex items-center px-3 py-1 rounded-full text-sm font-medium bg-pink-100 text-pink-800 dark:bg-pink-900/30 dark:text-pink-300"
            >
              {{ tag.strip() }}
            </span>
            {% endfor %}
          </div>
        </div>
        {% endif %}

        <!-- Location -->
        {% if photo.location %}
        <div class="mb-6">
          <h3
            class="text-lg font-semibold text-gray-700 dark:text-gray-300 mb-3 flex items-center"
          >
            <i class="fas fa-map-marker-alt text-pink-500 mr-2"></i>
            Location
          </h3>
          <div
            class="bg-white/50 dark:bg-gray-700/50 rounded-xl p-4 border border-pink-100 dark:border-gray-600"
          >
            <p class="text-gray-700 dark:text-gray-300 font-medium">
              {{ photo.location }}
            </p>
          </div>
        </div>
        {% endif %}

        <!-- Share Section -->
        <div class="mt-8 pt-6 border-t border-pink-200 dark:border-gray-600">
          <h3
            class="text-lg font-semibold text-gray-700 dark:text-gray-300 mb-3 flex items-center"
          >
            <i class="fas fa-share-alt text-pink-500 mr-2"></i>
            Share This Memory
          </h3>
          <div class="flex justify-center space-x-4">
            <button
              onclick="shareMemory()"
              class="p-3 bg-pink-500 text-white rounded-full hover:bg-pink-600 transition-all duration-300 transform hover:scale-110 shadow-lg"
            >
              <i class="fas fa-share"></i>
            </button>
            <button
              onclick="copyLink()"
              class="p-3 bg-purple-500 text-white rounded-full hover:bg-purple-600 transition-all duration-300 transform hover:scale-110 shadow-lg"
            >
              <i class="fas fa-link"></i>
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Navigation -->
  <div class="flex justify-between items-center mt-8">
    {% if prev_photo %}
    <a
      href="{{ url_for('photo_detail', photo_id=prev_photo.id) }}"
      class="inline-flex items-center px-6 py-3 bg-white dark:bg-gray-800 text-gray-700 dark:text-gray-300 rounded-2xl border border-pink-200 dark:border-gray-600 shadow-lg transform transition-all duration-300 hover:scale-105 hover:shadow-xl"
    >
      <i class="fas fa-chevron-left mr-2"></i>
      Previous
    </a>
    {% else %}
    <div></div>
    {% endif %} {% if next_photo %}
    <a
      href="{{ url_for('photo_detail', photo_id=next_photo.id) }}"
      class="inline-flex items-center px-6 py-3 bg-white dark:bg-gray-800 text-gray-700 dark:text-gray-300 rounded-2xl border border-pink-200 dark:border-gray-600 shadow-lg transform transition-all duration-300 hover:scale-105 hover:shadow-xl"
    >
      Next
      <i class="fas fa-chevron-right ml-2"></i>
    </a>
    {% else %}
    <div></div>
    {% endif %}
  </div>
</div>

<script>
  // Toggle favorite
  async function toggleFavorite(photoId) {
    try {
      const response = await fetch(`/toggle_favorite/${photoId}`, {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
        },
      });

      const data = await response.json();
      const button = document.getElementById("favoriteBtn");
      const icon = button.querySelector("i");

      if (data.is_favorite) {
        icon.classList.remove("text-gray-400");
        icon.classList.add("text-red-500");
        // Add heart animation
        button.classList.add("animate-pulse");
        setTimeout(() => button.classList.remove("animate-pulse"), 600);
      } else {
        icon.classList.remove("text-red-500");
        icon.classList.add("text-gray-400");
      }
    } catch (error) {
      console.error("Error toggling favorite:", error);
    }
  }

  // Share functionality
  async function shareMemory() {
    const shareData = {
      title: "Our Beautiful Memory",
      text: '{{ photo.caption or "Check out this beautiful memory from our gallery!" }}',
      url: window.location.href,
    };

    try {
      if (navigator.share) {
        await navigator.share(shareData);
      } else {
        // Fallback: copy to clipboard
        await copyLink();
      }
    } catch (err) {
      console.log("Error sharing:", err);
    }
  }

  // Copy link to clipboard
  async function copyLink() {
    try {
      await navigator.clipboard.writeText(window.location.href);
      // Show success message
      const originalText = event.target.innerHTML;
      event.target.innerHTML = '<i class="fas fa-check"></i>';
      event.target.classList.add("bg-green-500");
      setTimeout(() => {
        event.target.innerHTML = originalText;
        event.target.classList.remove("bg-green-500");
      }, 2000);
    } catch (err) {
      console.log("Failed to copy: ", err);
    }
  }

  // Add image zoom on click
  document.getElementById("mainPhoto").addEventListener("click", function () {
    this.classList.toggle("cursor-zoom-out");
    if (this.classList.contains("cursor-zoom-out")) {
      this.style.transform = "scale(2)";
      this.style.cursor = "zoom-out";
    } else {
      this.style.transform = "scale(1)";
      this.style.cursor = "zoom-in";
    }
  });

  // Add entrance animation
  document.addEventListener("DOMContentLoaded", function () {
    gsap.fromTo(
      ".bg-white\\/80",
      {
        opacity: 0,
        y: 30,
      },
      {
        opacity: 1,
        y: 0,
        duration: 0.8,
        ease: "power2.out",
      }
    );
  });
</script>

<style>
  #mainPhoto {
    cursor: zoom-in;
    transition: transform 0.3s ease;
  }

  .animate-pulse {
    animation: pulse 0.6s ease-in-out;
  }
</style>
{% endblock %}
